<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mouse Dodge Game Deluxe</title>
<style>
body {
    margin: 0;
    overflow: hidden;
    cursor: url('YOUR_CURSOR_IMAGE.png'), auto; /* Replace with your cursor image */
    background-color: #222;
    font-family: Arial, sans-serif;
}
#gameCanvas { display: block; background-color: #333; }
#ui {
    position: absolute;
    top: 10px;
    left: 10px;
    color: white;
}
#score, #highScore, #usernameInput, #leaderboard, #rank, #worldRecordNotif {
    margin: 5px 0;
}
input { padding: 5px; font-size: 16px; }
#worldRecordNotif {
    color: yellow;
    font-weight: bold;
    display: none;
}
</style>
</head>
<body>
<div id="ui">
    <div>
        Username: <input type="text" id="usernameInput" placeholder="Enter your name">
    </div>
    <div id="score">Score: 0</div>
    <div id="highScore">High Score: 0</div>
    <div id="rank">Rank: 0</div>
    <div id="leaderboard"><strong>Leaderboard:</strong><br>Loading...</div>
    <div id="worldRecordNotif">ðŸŒŸ New World Record! ðŸŒŸ</div>
</div>
<canvas id="gameCanvas"></canvas>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

<script>
/* --- FIREBASE CONFIG --- */
// Import the functions you need from the SDKs you need
import { initializeApp } from "firebase/app";
import { getAnalytics } from "firebase/analytics";
// TODO: Add SDKs for Firebase products that you want to use
// https://firebase.google.com/docs/web/setup#available-libraries

// Your web app's Firebase configuration
// For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyBonSbMLHvbMDpPYKqI2R34sH1hd4bgmE8",
  authDomain: "dodger-d0c2e.firebaseapp.com",
  projectId: "dodger-d0c2e",
  storageBucket: "dodger-d0c2e.firebasestorage.app",
  messagingSenderId: "157369124865",
  appId: "1:157369124865:web:8b537dbb20942760999800",
  measurementId: "G-8ZGPY7KG8T"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app);

/* --- GAME VARIABLES --- */
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let score = 0;
let highScore = localStorage.getItem('mouseDodgeHigh') || 0;
let obstacles = [];
let mouseX = 0;
let mouseY = 0;
let username = '';
let worldRecord = 0;

document.getElementById('highScore').innerText = 'High Score: ' + highScore;

/* --- USERNAME INPUT --- */
const usernameInput = document.getElementById('usernameInput');
usernameInput.addEventListener('change', () => {
    username = usernameInput.value.trim() || 'Player';
});

/* --- MOUSE TRACKING --- */
document.addEventListener('mousemove', e => {
    mouseX = e.clientX;
    mouseY = e.clientY;
});

document.addEventListener('mouseleave', () => { resetGame(); });

/* --- HIT SOUND --- */
const hitSound = new Audio('hit_sound.mp3'); // Replace with your sound file

/* --- OBSTACLE CLASS WITH BEHAVIORS --- */
class Obstacle {
    constructor(type) {
        this.type = type;
        this.x = Math.random() * canvas.width;
        this.y = -20;
        this.size = 20 + Math.random()*40;
        this.speed = 2 + Math.random()*4;
        this.color = type===1?'red':type===2?'yellow':'blue';
        this.angle = 0; // for zig-zag
        this.zigSpeed = 0.05 + Math.random()*0.05;
        this.bounce = type===3 ? true : false;
        this.direction = 1;
    }
    update() {
        if(this.type===1) this.y += this.speed; // simple fall
        if(this.type===2) { // zig-zag
            this.y += this.speed;
            this.x += Math.sin(this.angle)*50*0.02;
            this.angle += this.zigSpeed;
        }
        if(this.bounce) { // bouncing horizontally
            this.y += this.speed;
            this.x += this.direction * this.speed;
            if(this.x < 0 || this.x > canvas.width) this.direction *= -1;
        }

        // Collision with mouse
        const dx = mouseX - this.x;
        const dy = mouseY - this.y;
        if(Math.sqrt(dx*dx + dy*dy) < this.size/2) {
            hitSound.play();
            resetGame();
        }
    }
    draw() {
        ctx.fillStyle = this.color;
        ctx.beginPath();
        if(this.type===1) ctx.arc(this.x, this.y, this.size/2, 0, Math.PI*2);
        if(this.type===2) ctx.fillRect(this.x-this.size/2,this.y-this.size/2,this.size,this.size);
        if(this.type===3) {
            ctx.moveTo(this.x, this.y-this.size/2);
            ctx.lineTo(this.x-this.size/2,this.y+this.size/2);
            ctx.lineTo(this.x+this.size/2,this.y+this.size/2);
            ctx.closePath();
        }
        ctx.fill();
    }
}

/* --- GAME LOOP --- */
function gameLoop() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // Spawn obstacles
    if (Math.random() < 0.03) obstacles.push(new Obstacle(Math.floor(Math.random()*3)+1));

    obstacles.forEach(ob => { ob.update(); ob.draw(); });

    score += 0.1;
    document.getElementById('score').innerText = 'Score: ' + Math.floor(score);

    requestAnimationFrame(gameLoop);
}

gameLoop();

/* --- RESET FUNCTION --- */
function resetGame() {
    if(score > highScore) {
        highScore = Math.floor(score);
        localStorage.setItem('mouseDodgeHigh', highScore);
        document.getElementById('highScore').innerText = 'High Score: ' + highScore;
    }
    if(username) {
        db.ref('leaderboard/' + username).set({ score: highScore });
    }
    // Check world record
    if(Math.floor(score) > worldRecord) {
        worldRecord = Math.floor(score);
        db.ref('worldRecord').set(worldRecord);
        document.getElementById('worldRecordNotif').style.display='block';
        setTimeout(()=>{document.getElementById('worldRecordNotif').style.display='none'},3000);
    }
    score = 0;
    obstacles = [];
}

/* --- LEADERBOARD & RANK --- */
function updateLeaderboard() {
    db.ref('leaderboard').orderByChild('score').on('value', snapshot => {
        const data = snapshot.val();
        if(!data) return;
        const sorted = Object.entries(data).sort((a,b)=>b[1].score - a[1].score);
        const board = sorted.slice(0,5).map(([name,val])=>`${name}: ${val.score}`).join('<br>');
        document.getElementById('leaderboard').innerHTML = '<strong>Leaderboard:</strong><br>' + board;

        // Show your rank
        if(username){
            const rank = sorted.findIndex(([name,val])=>name===username)+1 || '-';
            document.getElementById('rank').innerText = 'Rank: ' + rank;
        }
    });

    // Load world record
    db.ref('worldRecord').on('value', snapshot => {
        worldRecord = snapshot.val() || 0;
    });
}
updateLeaderboard();

/* --- RESIZE CANVAS --- */
window.addEventListener('resize', () => {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
});
</script>
</body>
</html>
