<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mouse Dodge Game Deluxe</title>
<style>
body {
    margin: 0;
    overflow: hidden;
    cursor: url('YOUR_CURSOR_IMAGE.png'), auto;
    background-color: #222;
    font-family: Arial, sans-serif;
}
#gameCanvas { display: block; background-color: #333; }
#topBlock {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 80px;
    background-color: #111;
    z-index: 1000;
}
#ui {
    position: absolute;
    top: 90px; /* moved below top block */
    left: 10px;
    color: white;
    z-index: 1001;
}
#score, #highScore, #usernameInput, #passwordInput, #leaderboard, #rank, #worldRecordNotif {
    margin: 5px 0;
}
input { padding: 5px; font-size: 16px; margin-right:5px;}
button { padding: 5px 10px; font-size: 16px; margin-right:5px; }
#worldRecordNotif {
    color: yellow;
    font-weight: bold;
    display: none;
}
</style>
</head>
<body>
<div id="topBlock"></div> <!-- Blocks cheating at the top -->

<div id="ui">
    <div>
        Username: <input type="text" id="usernameInput" placeholder="Enter username">
        Password: <input type="password" id="passwordInput" placeholder="Enter password">
        <button id="registerBtn">Register</button>
        <button id="loginBtn">Login</button>
    </div>
    <div id="userStatus">Not logged in</div>
    <div id="score">Score: 0</div>
    <div id="highScore">High Score: 0</div>
    <div id="rank">Rank: 0</div>
    <div id="leaderboard"><strong>Leaderboard:</strong><br>Loading...</div>
    <div id="worldRecordNotif">ðŸŒŸ New World Record! ðŸŒŸ</div>
</div>

<canvas id="gameCanvas"></canvas>

<!-- Firebase compat scripts -->
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

<script>
// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyBonSbMLHvbMDpPYKqI2R34sH1hd4bgmE8",
  authDomain: "dodger-d0c2e.firebaseapp.com",
  databaseURL: "https://dodger-d0c2e-default-rtdb.firebaseio.com",
  projectId: "dodger-d0c2e",
  storageBucket: "dodger-d0c2e.appspot.com",
  messagingSenderId: "157369124865",
  appId: "1:157369124865:web:8b537dbb20942760999800"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

/* --- GAME VARIABLES --- */
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let score = 0;
let highScore = 0;
let obstacles = [];
let mouseX = 0;
let mouseY = 0;
let currentUser = null;
let worldRecord = 0;

document.getElementById('highScore').innerText = 'High Score: ' + highScore;

/* --- AUTH ELEMENTS --- */
const usernameInput = document.getElementById('usernameInput');
const passwordInput = document.getElementById('passwordInput');
const registerBtn = document.getElementById('registerBtn');
const loginBtn = document.getElementById('loginBtn');
const userStatus = document.getElementById('userStatus');

/* --- REGISTER --- */
registerBtn.addEventListener('click', () => {
    const username = usernameInput.value.trim();
    const password = passwordInput.value;
    if(!username || !password) return alert("Enter username and password");

    db.ref('users/' + username).get().then(snapshot => {
        if(snapshot.exists()) return alert("Username taken");
        db.ref('users/' + username).set({ password: password, highScore: 0 });
        currentUser = username;
        highScore = 0;
        document.getElementById('highScore').innerText = 'High Score: ' + highScore;
        userStatus.innerText = "Logged in as: " + username;
        updateLeaderboard();
    });
});

/* --- LOGIN --- */
loginBtn.addEventListener('click', () => {
    const username = usernameInput.value.trim();
    const password = passwordInput.value;
    db.ref('users/' + username).get().then(snapshot => {
        if(!snapshot.exists()) return alert("User not found");
        if(snapshot.val().password !== password) return alert("Incorrect password");
        currentUser = username;
        highScore = snapshot.val().highScore || 0;
        document.getElementById('highScore').innerText = 'High Score: ' + highScore;
        userStatus.innerText = "Logged in as: " + username;
        updateLeaderboard();
    });
});

/* --- MOUSE TRACKING --- */
document.addEventListener('mousemove', e => { mouseX = e.clientX; mouseY = e.clientY; });
document.addEventListener('mouseleave', () => { resetGame(); });

/* --- HIT SOUND --- */
const hitSound = new Audio('hit_sound.mp3'); // Replace with your sound

/* --- OBSTACLE CLASS --- */
class Obstacle {
    constructor(type) {
        this.type = type;
        this.x = Math.random() * canvas.width;
        this.y = -20;
        this.size = 20 + Math.random()*40;
        this.speed = 3 + Math.random()*5; // faster obstacles
        this.color = type===1?'red':type===2?'yellow':'blue';
        this.angle = 0;
        this.zigSpeed = 0.1 + Math.random()*0.1; // faster zig
        this.bounce = type===3 ? true : false;
        this.direction = 1;
    }
    update() {
        if(this.type===1) this.y += this.speed;
        if(this.type===2) { this.y += this.speed; this.x += Math.sin(this.angle)*50*0.03; this.angle += this.zigSpeed; }
        if(this.bounce) { this.y += this.speed; this.x += this.direction * this.speed; if(this.x < 0 || this.x > canvas.width) this.direction *= -1; }

        const dx = mouseX - this.x;
        const dy = mouseY - this.y;
        if(Math.sqrt(dx*dx + dy*dy) < this.size/2) { hitSound.play(); resetGame(); }
    }
    draw() {
        ctx.fillStyle = this.color;
        ctx.beginPath();
        if(this.type===1) ctx.arc(this.x, this.y, this.size/2, 0, Math.PI*2);
        if(this.type===2) ctx.fillRect(this.x-this.size/2,this.y-this.size/2,this.size,this.size);
        if(this.type===3) { ctx.moveTo(this.x, this.y-this.size/2); ctx.lineTo(this.x-this.size/2,this.y+this.size/2); ctx.lineTo(this.x+this.size/2,this.y+this.size/2); ctx.closePath(); }
        ctx.fill();
    }
}

/* --- GAME LOOP --- */
function gameLoop() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    if(Math.random() < 0.06) obstacles.push(new Obstacle(Math.floor(Math.random()*3)+1)); // spawn faster
    obstacles.forEach(ob => { ob.update(); ob.draw(); });
    score += 0.15; // score increases faster
    document.getElementById('score').innerText = 'Score: ' + Math.floor(score);
    requestAnimationFrame(gameLoop);
}
gameLoop();

/* --- RESET FUNCTION --- */
function resetGame() {
    if(currentUser && score > highScore){
        highScore = Math.floor(score);
        document.getElementById('highScore').innerText = 'High Score: ' + highScore;
        db.ref('users/' + currentUser).update({ highScore });
        db.ref('leaderboard/' + currentUser).set({ score: highScore });
    }
    if(Math.floor(score) > worldRecord){
        worldRecord = Math.floor(score);
        db.ref('worldRecord').set(worldRecord);
        document.getElementById('worldRecordNotif').style.display='block';
        setTimeout(()=>{document.getElementById('worldRecordNotif').style.display='none'},3000);
    }
    score = 0;
    obstacles = [];
    updateLeaderboard();
}

/* --- LEADERBOARD --- */
function updateLeaderboard(){
    db.ref('leaderboard').orderByChild('score').limitToLast(5).once('value', snapshot=>{
        const data = snapshot.val();
        if(!data) return;
        const sorted = Object.entries(data).sort((a,b)=>b[1].score - a[1].score);
        const board = sorted.map(([name,val])=>`${name}: ${val.score}`).join('<br>');
        document.getElementById('leaderboard').innerHTML = '<strong>Leaderboard:</strong><br>' + board;

        // Rank
        if(currentUser){
            db.ref('leaderboard').orderByChild('score').once('value', snap=>{
                const allData = snap.val();
                if(!allData) return;
                const allSorted = Object.entries(allData).sort((a,b)=>b[1].score - a[1].score);
                const rank = allSorted.findIndex(([name,val])=>name===currentUser)+1 || '-';
                document.getElementById('rank').innerText = 'Rank: ' + rank;
            });
        }
    });
    // World record
    db.ref('worldRecord').once('value', snapshot => { worldRecord = snapshot.val() || 0; });
}

// Refresh leaderboard every 5 seconds
setInterval(updateLeaderboard,5000);

/* --- RESIZE CANVAS --- */
window.addEventListener('resize', () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; });
</script>
</body>
</html>
